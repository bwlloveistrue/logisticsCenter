<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<sqlMap namespace="com.logisticscenter.mapper.TruckInfoDao">
  <typeAlias type="com.entity.TruckEntity" alias="truckE"/>
  <resultMap id="truckMap" class="com.entity.TruckEntity" >
 	<result column="id" property="id" jdbcType="INT" />
	<result column="truckNumber" property="truckNumber" jdbcType="VARCHAR" />
	<result column="truckOwner" property="truckOwner" jdbcType="VARCHAR" />
	<result column="truckBrand" property="truckBrand" jdbcType="VARCHAR" />
	<result column="truckName" property="truckName" jdbcType="VARCHAR" />
	<result column="contactNumber" property="contactNumber" jdbcType="VARCHAR" />
	<result column="truckType" property="truckType" jdbcType="INT" />
	<result column="driver" property="driver" jdbcType="INT" />
	<result column="truckColor" property="truckColor" jdbcType="VARCHAR" />
	<result column="truckLength" property="truckLength" jdbcType="DECIMAL" />
	<result column="truckWidth" property="truckWidth" jdbcType="DECIMAL" />
	<result column="truckHeight" property="truckHeight" jdbcType="DECIMAL" />
	<result column="standardWeight" property="standardWeight" jdbcType="DECIMAL" />
	<result column="driverLicense" property="driverLicense" jdbcType="VARCHAR" />
	<result column="engineNumber" property="engineNumber" jdbcType="VARCHAR" />
	<result column="madeDate" property="madeDate" jdbcType="VARCHAR" />
	<result column="buyDate" property="buyDate" jdbcType="VARCHAR" />
	<result column="worth" property="worth" jdbcType="DECIMAL" />
	<result column="buyCost" property="buyCost" jdbcType="DECIMAL" />
	<result column="remark" property="remark" jdbcType="VARCHAR" />
	<result column="commercialDate" property="commercialDate" jdbcType="VARCHAR" />
	<result column="compulsoryDate" property="compulsoryDate" jdbcType="VARCHAR" />
	<result column="createDate" property="createDate" jdbcType="VARCHAR" />
	<result column="createTime" property="createTime" jdbcType="VARCHAR" />
	<result column="editDate" property="editDate" jdbcType="VARCHAR" />
	<result column="editTime" property="editTime" jdbcType="VARCHAR" />
  </resultMap>
  
  <!--查询所有车辆信息 -->
  <select id="getAllTruck" resultMap="truckMap">
    select a.* from truckInfo a left join commercialInsurance b on a.id=b.truckNumber left join compulsoryInsurance c on a.id = c.truckNumber
  </select>
  
  <!-- 根据车辆名称查询 -->
  <select id="getTruckBy" resultMap="truckMap" parameterClass="truckE">
    select top $pageSize$ * from (select row_number() over(order by a.id desc) as rownumber,a.* from truckInfo a left join commercialInsurance b on a.id=b.truckNumber left join compulsoryInsurance c on a.id = c.truckNumber 
    <dynamic prepend="WHERE ">
		<isNotEmpty prepend="AND" property="truckNumber">
			a.truckNumber like '%' + #truckNumber# +  '%' 
		</isNotEmpty>
		<isGreaterThan prepend="AND" property="driver" compareValue="0">
			a.driver = #driver#
		</isGreaterThan>
		
		<isNotEmpty prepend="AND" property="truckBrand">
			a.truckBrand like '%' + #truckBrand# +  '%' 
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="engineNumber">
			a.engineNumber like '%' + #engineNumber# +  '%' 
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="buyStartDate">
			a.buyDate &gt; #buyStartDate#  
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="buyEndDate">
			a.buyDate &lt; #buyEndDate# 
		</isNotEmpty>
	</dynamic>
	) d
	<dynamic prepend="WHERE ">
		<isNotEmpty prepend="AND" property="currentPage">
			rownumber > $currentPage$
		</isNotEmpty>
	</dynamic>
  </select>
  
  <!-- 根据车辆名称查询 -->
  <select id="getTruckByCount" resultClass="String" parameterClass="truckE">
    select count(*) from (select row_number() over(order by a.id desc) as rownumber,a.* from truckInfo a left join commercialInsurance b on a.id=b.truckNumber left join compulsoryInsurance c on a.id = c.truckNumber ) d
    <dynamic prepend="WHERE ">
		<isNotEmpty prepend="AND" property="truckNumber">
			a.truckNumber like '%' + #truckNumber# +  '%' 
		</isNotEmpty>
		<isGreaterThan prepend="AND" property="driver" compareValue="0">
			a.driver = #driver#
		</isGreaterThan>
		
		<isNotEmpty prepend="AND" property="truckBrand">
			a.truckBrand like '%' + #truckBrand# +  '%' 
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="engineNumber">
			a.engineNumber like '%' + #engineNumber# +  '%' 
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="buyStartDate">
			a.buyDate &gt; #buyStartDate#  
		</isNotEmpty>
		<isNotEmpty prepend="AND" property="buyEndDate">
			a.buyDate &lt; #buyEndDate# 
		</isNotEmpty>
	</dynamic>
  </select>
  
  <!-- 根据id获得用户对象 -->
    <select id="getTruckById" resultMap="truckMap">
     select * from truckInfo where id=#id#
  </select> 
  
   <!-- 新增用户对象 -->
	<insert id="insertTruck" parameterClass="truckE">
		insert into truckInfo (truckNumber,truckOwner,truckBrand,truckName,contactNumber,truckType,driver,truckColor,truckLength,truckWidth,truckHeight,standardWeight,driverLicense,engineNumber,madeDate,buyDate,worth,buyCost,remark) 
		values (#truckNumber#,#truckOwner#,#truckBrand#,#truckName#,#contactNumber#,#truckType#,#driver#,#truckColor#,#truckLength#,#truckWidth#,#truckHeight#,#standardWeight#,#driverLicense#,#engineNumber#,#madeDate#,#buyDate#,#worth#,#buyCost#,#remark#)
		<selectKey resultClass="int" keyProperty="id" type="post">    
			SELECT max(id) as id from truckInfo
		</selectKey>
   </insert>
   
   <!-- 删除用户对象 -->
   <delete id="deleteTruck" parameterClass="java.util.List">
     delete from truckInfo 
	<iterate prepend="WHERE" open="(" close=")"
	conjunction="OR">
	id=#idLst[]#
	</iterate>
   </delete>
   
   <!-- 更新用户对象 -->
   <update id="updateTruck" parameterClass="truckE">
		update truckInfo set
			truckNumber=#truckNumber#,
			truckOwner=#truckOwner#,
			truckBrand=#truckBrand#,
			truckName=#truckName#,
			contactNumber=#contactNumber#,
			truckType=#truckType#,
			driver=#driver#,
			truckColor=#truckColor#,
			truckLength=#truckLength#,
			truckWidth=#truckWidth#,
			truckHeight=#truckHeight#,
			standardWeight=#standardWeight#,
			driverLicense=#driverLicense#,
			engineNumber=#engineNumber#,
			madeDate=#madeDate#,
			buyDate=#buyDate#,
			worth=#worth#,
			buyCost=#buyCost#,
			remark=#remark#
		where id=#id#
   </update>
</sqlMap>